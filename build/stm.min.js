!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.SpeakToMe=e()}}(function(){return function e(t,n,o){function r(s,a){if(!n[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var d=n[s]={exports:{}};t[s][0].call(d.exports,function(e){var n=t[s][1][e];return r(n||e)},d,d.exports,e,t,n,o)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<o.length;s++)r(o[s]);return r}({1:[function(e,t,n){function o(e){function t(){function e(e){h=e,c()}if("ready"!=w)return void console.warn("Listen() called when not ready");d.vad&&!S&&(S=SpeakToMeVAD({listener:e}));var t={audio:!0};navigator.mediaDevices.getUserMedia(t).then(n).catch(function(e){console.error(e)})}function n(e){if(m=e,u({state:"listening"}),l=new AudioContext,p=l.createMediaStreamSource(e),f=l.createAnalyser(),v=l.createMediaStreamDestination(),p.channelCount=1,f.channelCount=1,v.channelCount=1,p.connect(f),f.connect(v),d.vad){h="";scriptprocessor=l.createScriptProcessor(2048,1,1),scriptprocessor.onaudioprocess=S.onAudioProcessingEvent,p.connect(scriptprocessor)}var t={audioBitsPerSecond:s,mimeType:a};g=new MediaRecorder(v.stream,t),g.start(),d.vad||setTimeout(c,d.timeout),g.onstop=function(t){if(u({state:"processing"}),d.vad&&"novoice"==h||!n[0].size)u({state:"result",data:[]}),u({state:"ready"});else{o(new Blob(n,{type:"audio/ogg; codecs=opus"}))}n=[],g=null,l=null,p=null,f=null,v=null,e=null,scriptprocessor=null};var n=[];g.ondataavailable=function(e){n.push(e.data)}}function o(e){u({state:"sending"}),fetch(d.serverURL,{method:"POST",body:e}).then(function(e){return e.json()}).then(function(e){"ok"===e.status?(u({state:"result",data:e.data}),u({state:"ready"})):console.error("Error parsing JSON response:",error)}).catch(function(e){console.error("Fetch error:",e)})}function c(){if("listening"!=w)return void console.warn("stopListening(): stopping but not listening?!");m.getAudioTracks()[0].stop(),g.stop(),p.disconnect(scriptprocessor),p.disconnect(f),f.disconnect(v)}function u(e){if(w=e.state,!d.listener)return void console.warn("SpeakToMe: You need to initialize SpeakToMe with an event listener!");try{d.listener(e)}catch(e){console.error("SpeakToMe: Listener error",e)}}var d={vad:!0,timeout:i,continuous:!1,serverURL:r,listener:null};e&&(!1===e.vad&&(d.vad=!1),e.timeout&&(d.timeout=e.timeout),e.listener&&(d.listener=e.listener));var l,p,f,v,g,m,h,w="ready",S=null;return{listen:t,stop:c,setListener:function(e){d.listener=e}}}var r="https://speaktome.services.mozilla.com",i=3e3,s=16e3,a="audio/ogg";!function(){void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(e){var t=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return t?new Promise(function(n,o){t.call(navigator,e,n,o)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))})}(),void 0!==t&&(t.exports=o)},{}],2:[function(e,t,n){void 0!==t&&(t.exports=SpeakToMe);var o={preRun:[],postRun:[],print:function(){return function(e){console.log("[webrtc_vad.js print]",e)}}(),printErr:function(e){console.error("[webrtc_vad.js error]",e)},canvas:void 0,setStatus:function(e){console.log("[webrtc_vad.js status] ",e)},totalDependencies:0,monitorRunDependencies:function(e){this.totalDependencies=Math.max(this.totalDependencies,e),o.setStatus(e?"Preparing... ("+(this.totalDependencies-e)+"/"+this.totalDependencies+")":"All downloads complete.")}};o.setStatus("Loading webrtc_vad..."),window.onerror=function(e){o.setStatus("Exception thrown, see JavaScript console"),o.setStatus=function(e){e&&o.printErr("[post-exception status] "+e)}},o.noInitialRun=!0,o.onRuntimeInitialized=function(){o.setStatus("Webrtc_vad and SpeakToMeVad loaded")}},{}]},{},[1,2])(2)});
